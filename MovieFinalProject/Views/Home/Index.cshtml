@model MovieFinalProject.ViewModel.HomeViewModel

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- CSS -->
	<link rel="stylesheet" href="~/assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="~/assets/css/splide.min.css">
	<link rel="stylesheet" href="~/assets/css/slimselect.css">
	<link rel="stylesheet" href="~/assets/css/plyr.css">
	<link rel="stylesheet" href="~/assets/css/photoswipe.css">
	<link rel="stylesheet" href="~/assets/css/default-skin.css">
	<link rel="stylesheet" href="~/assets/css/main.css">

	<!-- Icon font -->
	<link rel="stylesheet" href="~/assets/webfont/tabler-icons.min.css">

	<!-- Favicons -->
	<link rel="icon" type="image/png" href="~/assets/icon/favicon-32x32.png" sizes="32x32">
	<link rel="apple-touch-icon" href="~/assets/icon/favicon-32x32.png">

	<meta name="description" content="Online Movies, TV Shows & Cinema website">
	<meta name="keywords" content="">
	<meta name="author" content="Dmitry Volkov">
	<title>HotFlix – Online Movies, TV Shows & Cinema website</title>
</head>

<body>
	<!-- home -->
	<section class="home home--hero">
		<div class="row">
			<!-- hero carousel -->
			<div class="col-12">
				<div class="hero splide splide--hero">
					<div class="splide__arrows">
						<button class="splide__arrow splide__arrow--prev" type="button">
							<i class="ti ti-chevron-left"></i>
						</button>
						<button class="splide__arrow splide__arrow--next" type="button">
							<i class="ti ti-chevron-right"></i>
						</button>
					</div>

					<div class="splide__track">
						<ul class="splide__list">
							@foreach (var movie in Model.HeroMovies)
							{
								var rating = Model.GetMovieRating(movie);
								var ratingClass = Model.GetRatingClass(rating);

								<li class="splide__slide">
									<div class="hero__slide" data-bg="~/@(movie.BackgroundImagePath ?? movie.ImagePath)">
										<div class="hero__content">
											<h2 class="hero__title">
												@movie.Title
												<sub class="@ratingClass">@rating.ToString("F1")</sub>
											</h2>
											<p class="hero__text">@movie.Description</p>
											<p class="hero__category">
												@{
													var mainActors = Model.GetMainActors(movie, 3);
												}
												@foreach (var actor in mainActors)
												{
													<a href="#">@actor.Name</a>
												}
											</p>
											<div class="hero__actions">
												<a asp-controller="Details" asp-action="Index" asp-route-id="@movie.Id" class="hero__btn">
													<span>Watch now</span>
												</a>
											</div>
										</div>
									</div>
								</li>
							}
						</ul>
					</div>
				</div>
			</div>
			<!-- end hero carousel -->
		</div>
	</section>
	<!-- end home -->
	<!-- fixed filter wrap -->
	<div>
		<!-- filter (fixed position) -->
		<div class="filter filter--fixed">
			<div class="container">
				<div class="row">
					<div class="col-12">
						<div class="filter__content">
							<!-- menu btn -->
							<button class="filter__menu" type="button"><i class="ti ti-filter"></i>Filter</button>
							<!-- end menu btn -->
							<!-- filter desk -->
							<div class="filter__items">
								<select class="filter__select" name="genre" id="filter__genre">
									<option value="0">All genres</option>
									@foreach (var genre in Model.Genres)
									{
										<option value="@genre.Id">@genre.Name</option>
									}
								</select>

								<select class="filter__select" name="quality" id="filter__quality">
									<option value="0">Any quality</option>
									@foreach (var quality in Model.Qualities)
									{
										<option value="@quality.Id">@quality.Name</option>
									}
								</select>

								<select class="filter__select" name="rate" id="filter__rate">
									<option value="0">Any rating</option>
									<option value="3">from 3.0</option>
									<option value="5">from 5.0</option>
									<option value="7">from 7.0</option>
									<option value="9">Golden Star (9+)</option>
								</select>

								<select class="filter__select" name="sort" id="filter__sort">
									<option value="0">Relevance</option>
									<option value="1">Newest</option>
									<option value="2">Oldest</option>
								</select>
							</div>
							<!-- end filter desk -->
							<!-- filter btn -->
							<button class="filter__btn" type="button" onclick="applyFilter()">Apply</button>
							<!-- end filter btn -->
							<!-- amount -->
							<span class="filter__amount">Showing <span id="showing-count">@Model.CatalogMovies.Count</span> of <span id="total-count">@Model.TotalMoviesCount</span></span>
							<!-- end amount -->
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- end filter (fixed position) -->
		<!-- catalog -->
		<div class="section section--catalog">
			<div class="container">
				<div class="row" id="movies-container">
					@foreach (var movie in Model.CatalogMovies)
					{
						var rating = Model.GetMovieRating(movie);
						var ratingClass = Model.GetRatingClass(rating);
						var mainActors = Model.GetMainActors(movie);

						<div class="col-6 col-sm-4 col-lg-3 col-xl-2">
							<div class="item">
								<div class="item__cover">
									<img src="~/@movie.ImagePath" alt="@movie.Title">
									<a asp-controller="Details" asp-action="Index" asp-route-id="@movie.Id" class="item__play">
										<i class="ti ti-player-play-filled"></i>
									</a>
									<span class="item__rate item__rate--@ratingClass">@rating.ToString("F1")</span>
									<button class="item__favorite" type="button"><i class="ti ti-bookmark"></i></button>
								</div>
								<div class="item__content">
									<h3 class="item__title">
										<a asp-controller="Details" asp-action="Index" asp-route-id="@movie.Id">@movie.Title</a>
									</h3>
									<span class="item__category">
										@foreach (var actor in mainActors)
										{
											<a href="#">@actor.Name</a>
										}
									</span>
								</div>
							</div>
						</div>
					}
				</div>

				<div class="row">
					<!-- more -->
					<div class="col-12">
						<button class="section__more" type="button" onclick="loadMore()" id="load-more-btn">Load more</button>
					</div>
					<!-- end more -->
				</div>
			</div>
		</div>
		<!-- end catalog -->
	</div>
	<!-- end fixed filter wrap -->
	<!-- section -->
	<section class="section section--border">
		<div class="container">
			<div class="row">
				<!-- section title -->
				<div class="col-12">
					<div class="section__title-wrap">
						<h2 class="section__title">Expected premiere</h2>
						<a href="catalog.html" class="section__view section__view--carousel">View All</a>
					</div>
				</div>
				<!-- end section title -->
				<!-- carousel -->
				<div class="col-12">
					<div class="section__carousel splide splide--content">
						<div class="splide__arrows">
							<button class="splide__arrow splide__arrow--prev" type="button">
								<i class="ti ti-chevron-left"></i>
							</button>
							<button class="splide__arrow splide__arrow--next" type="button">
								<i class="ti ti-chevron-right"></i>
							</button>
						</div>

						<div class="splide__track">
							<ul class="splide__list">
								@foreach (var movie in Model.ExpectedMovies)
								{
									var rating = Model.GetMovieRating(movie);
									var ratingClass = Model.GetRatingClass(rating);
									var mainActors = Model.GetMainActors(movie);

									<li class="splide__slide">
										<div class="item item--carousel">
											<div class="item__cover">
												<img src="~/@movie.imq" alt="@movie.Title">
												<a asp-controller="Details" asp-action="Index" asp-route-id="@movie.Id" class="item__play">
													<i class="ti ti-player-play-filled"></i>
												</a>
												<span class="item__rate item__rate--@ratingClass">@rating.ToString("F1")</span>
												<button class="item__favorite" type="button"><i class="ti ti-bookmark"></i></button>
											</div>
											<div class="item__content">
												<h3 class="item__title">
													<a asp-controller="Details" asp-action="Index" asp-route-id="@movie.Id">@movie.Title</a>
												</h3>
												<span class="item__category">
													@foreach (var actor in mainActors)
													{
														<a href="#">@actor.Name</a>
													}
												</span>
											</div>
										</div>
									</li>
								}
							</ul>
						</div>
					</div>
				</div>
				<!-- end carousel -->
			</div>
		</div>
	</section>
	<!-- end section -->
	<!-- section -->
	<section class="section section--border">
		<div class="container">
			<div class="row">
				<div class="col-12">
					<h2 class="section__title">Select your plan</h2>
				</div>
			</div>

			<div class="row">
				<!-- plan -->
				<div class="col-12 col-md-6 col-lg-4 order-md-2 order-lg-1">
					<div class="plan">
						<h3 class="plan__title">Basic</h3>
						<span class="plan__price">Free</span>
						<ul class="plan__list">
							<li class="plan__item"><i class="ti ti-circle-check"></i> 7 days</li>
							<li class="plan__item"><i class="ti ti-circle-check"></i> 720p Resolution</li>
							<li class="plan__item plan__item--none"><i class="ti ti-circle-minus"></i> Limited Availability</li>
							<li class="plan__item plan__item--none"><i class="ti ti-circle-minus"></i> Desktop Only</li>
							<li class="plan__item plan__item--none"><i class="ti ti-circle-minus"></i> Limited Support</li>
						</ul>
						<a href="signin.html" class="plan__btn">Register</a>
					</div>
				</div>
				<!-- end plan -->
				<!-- plan -->
				<div class="col-12 col-md-12 col-lg-4 order-md-1 order-lg-2">
					<div class="plan plan--orange">
						<h3 class="plan__title">Premium</h3>
						<span class="plan__price">$34.99 <sub>/ month</sub></span>
						<ul class="plan__list">
							<li class="plan__item"><i class="ti ti-circle-check"></i> 1 Month</li>
							<li class="plan__item"><i class="ti ti-circle-check"></i> Full HD</li>
							<li class="plan__item"><i class="ti ti-circle-check"></i> Limited Availability</li>
							<li class="plan__item plan__item--none"><i class="ti ti-circle-minus"></i> TV & Desktop</li>
							<li class="plan__item plan__item--none"><i class="ti ti-circle-minus"></i> 24/7 Support</li>
						</ul>
						<button class="plan__btn" type="button" data-bs-toggle="modal" data-bs-target="#plan-modal">Choose Plan</button>
					</div>
				</div>
				<!-- end plan -->
				<!-- plan -->
				<div class="col-12 col-md-6 col-lg-4 order-md-3">
					<div class="plan plan--red">
						<h3 class="plan__title">Cinematic</h3>
						<span class="plan__price">$49.99 <sub>/ month</sub></span>
						<ul class="plan__list">
							<li class="plan__item"><i class="ti ti-circle-check"></i> 2 Months</li>
							<li class="plan__item"><i class="ti ti-circle-check"></i> Ultra HD</li>
							<li class="plan__item"><i class="ti ti-circle-check"></i> Limited Availability</li>
							<li class="plan__item"><i class="ti ti-circle-check"></i> Any Device</li>
							<li class="plan__item"><i class="ti ti-circle-check"></i> 24/7 Support</li>
						</ul>
						<button class="plan__btn" type="button" data-bs-toggle="modal" data-bs-target="#plan-modal">Choose Plan</button>
					</div>
				</div>
				<!-- end plan -->
			</div>
		</div>
	</section>
	<!-- end section -->
	<!-- mobile filter -->
	<div class="mfilter">
		<div class="mfilter__head">
			<h6 class="mfilter__title">Filter</h6>
			<button class="mfilter__close" type="button"><i class="ti ti-x"></i></button>
		</div>

		<div class="mfilter__select-wrap">
			<div class="sign__group">
				<select class="filter__select" name="mgenre" id="mfilter__genre">
					<option value="0">All genres</option>
					@foreach (var genre in Model.Genres)
					{
						<option value="@genre.Id">@genre.Name</option>
					}
				</select>
			</div>

			<div class="sign__group">
				<select class="filter__select" name="mquality" id="mfilter__quality">
					<option value="0">Any quality</option>
					@foreach (var quality in Model.Qualities)
					{
						<option value="@quality.Id">@quality.Name</option>
					}
				</select>
			</div>

			<div class="sign__group">
				<select class="filter__select" name="mrate" id="mfilter__rate">
					<option value="0">Any rating</option>
					<option value="3">from 3.0</option>
					<option value="5">from 5.0</option>
					<option value="7">from 7.0</option>
					<option value="9">Golden Star (9+)</option>
				</select>
			</div>

			<div class="sign__group">
				<select class="filter__select" name="msort" id="mfilter__sort">
					<option value="0">Relevance</option>
					<option value="1">Newest</option>
					<option value="2">Oldest</option>
				</select>
			</div>
		</div>

		<button class="mfilter__apply" type="button" onclick="applyFilter()">Apply</button>
	</div>
	<!-- end mobile filter -->
	<!-- plan modal -->
	<div class="modal fade" id="plan-modal" tabindex="-1" aria-labelledby="plan-modal" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal__content">
					<button class="modal__close" type="button" data-bs-dismiss="modal" aria-label="Close"><i class="ti ti-x"></i></button>

					<form action="#" class="modal__form">
						<h4 class="modal__title">Select plan</h4>

						<div class="sign__group">
							<label for="fullname" class="sign__label">Name</label>
							<input id="fullname" type="text" name="name" class="sign__input" placeholder="Full name">
						</div>

						<div class="sign__group">
							<label for="email" class="sign__label">Email</label>
							<input id="email" type="text" name="email" class="sign__input" placeholder="example@domain.com">
						</div>

						<div class="sign__group">
							<label class="sign__label" for="value">Choose plan:</label>
							<select class="sign__select" name="value" id="value">
								<option value="35">Premium - $34.99</option>
								<option value="50">Cinematic - $49.99</option>
							</select>

							<span class="sign__text">You can spend money from your account on the renewal of the connected packages, or to order cars on our website.</span>
						</div>

						<div class="sign__group">
							<label class="sign__label">Payment method:</label>

							<ul class="sign__radio">
								<li>
									<input id="type1" type="radio" name="type" checked="">
									<label for="type1">Visa</label>
								</li>
								<li>
									<input id="type2" type="radio" name="type">
									<label for="type2">Mastercard</label>
								</li>
								<li>
									<input id="type3" type="radio" name="type">
									<label for="type3">Paypal</label>
								</li>
							</ul>
						</div>

						<button type="button" class="sign__btn sign__btn--modal">
							<span>Proceed</span>
						</button>
					</form>
				</div>
			</div>
		</div>
	</div>
	<!-- end plan modal -->
	<!-- JS -->
	<script src="~/assets/js/bootstrap.bundle.min.js"></script>
	<script src="~/assets/js/splide.min.js"></script>
	<script src="~/assets/js/slimselect.min.js"></script>
	<script src="~/assets/js/smooth-scrollbar.js"></script>
	<script src="~/assets/js/plyr.min.js"></script>
	<script src="~/assets/js/photoswipe.min.js"></script>
	<script src="~/assets/js/photoswipe-ui-default.min.js"></script>
	<script src="~/assets/js/main.js"></script>

	<script>
		let currentPage = 1;
		let isLoading = false;

		function applyFilter() {
			if (isLoading) return;

			isLoading = true;
			currentPage = 1;

			const genreId = document.getElementById('filter__genre').value;
			const qualityId = document.getElementById('filter__quality').value;
			const minRating = document.getElementById('filter__rate').value;
			const sort = document.getElementById('filter__sort').value;

			fetch('@Url.Action("FilterMovies", "Home")', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded',
				},
				body: `genreId=${genreId}&qualityId=${qualityId}&minRating=${minRating}&sort=${sort}&page=${currentPage}`
			})
			.then(response => response.json())
			.then(data => {
				updateMoviesContainer(data.movies, true);
				updateCounts(data.movies.length, data.totalCount);
				isLoading = false;
			})
			.catch(error => {
				console.error('Error:', error);
				isLoading = false;
			});
		}

		function loadMore() {
			if (isLoading) return;

			isLoading = true;
			currentPage++;

			fetch('@Url.Action("LoadMoreMovies", "Home")', {
				method: 'GET',
				headers: {
					'Content-Type': 'application/json',
				}
			})
			.then(response => response.json())
			.then(data => {
				if (data.movies.length > 0) {
					updateMoviesContainer(data.movies, false);
				} else {
					document.getElementById('load-more-btn').style.display = 'none';
				}
				isLoading = false;
			})
			.catch(error => {
				console.error('Error:', error);
				isLoading = false;
			});
		}

		function updateMoviesContainer(movies, replace = false) {
			const container = document.getElementById('movies-container');

			if (replace) {
				container.innerHTML = '';
			}

			movies.forEach(movie => {
				const rating = movie.rating || 0;
				const ratingClass = rating >= 7 ? 'green' : rating >= 5 ?
